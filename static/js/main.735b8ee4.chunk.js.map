{"version":3,"sources":["core/firebase.ts","core/types.ts","fe/ViewDebug.tsx","core/role.ts","fe/shared.tsx","core/utils.ts","fe/ViewMission.tsx","core/storage.ts","fe/ViewLobby.tsx","fe/ViewReset.tsx","fe/ViewBoard.tsx","fe/ViewSetup.tsx","fe/ViewBar.tsx","fe/ViewNominate.tsx","fe/ViewLady.tsx","fe/ViewAll.tsx","fe/ViewRules.tsx","fe/ViewHub.tsx","fe/ErrorBoundary.tsx","index.tsx"],"names":["dotenv","config","ViewTab","apiKey","process","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","FIREBASE","db","isOnline","firebase","initializeApp","this","database","console","log","Promise","resolve","reject","ref","once","resp","data","val","Object","values","game","playerId","gid","nominations","players","turn","mission","roster","filter","pid","tally","order","current","updateNominations","updatePlayers","updateTurn","updateMission","set","sawId","includeLady","gameId","showResults","dealerLocked","callback","on","off","ViewDebug","state","games","promise","makeTrashable","getAllGames","then","setState","trash","href","map","key","p","pi","onClick","kickPlayer","name","deleteAllGames","React","Component","MissionVoteType","NominationType","MissionResultType","Blue","Red","Neutral","MissionResults","Roles","RoleType","reduce","obj","r","reds","BasicRed","Assassin","Morgana","Mordred","Oberon","redsMinusMordred","redsMinusOberon","AllRoles","BasicBlue","isRed","description","sees","Merlin","Percival","Green","styled","span","StyledBox","div","HostBox","Flex","Board","MissionIcon","props","result","isDev","window","location","includes","isDebug","orig","toUpperCase","sortObjVals","keyFunc","arr","concat","sort","a","b","ka","kb","shuffle","temporaryValue","randomIndex","array","currentIndex","length","Math","floor","random","getCurrentPlayers","getBoardFor","count","missions","required","neededFails","vetos","ViewMission","storage","me","role","updateMissionTally","newVotes","isHost","nomRevealed","nomResults","nomApproved","n","isNom","pendingTally","voteSuccess","voteFail","keys","reverse","vote","i","toggleReveal","voteClear","STORAGE","store","localStorage","onSet","v","split","slice","join","hri","undefined","view","Reset","setItem","JSON","stringify","get","stored","getItem","parse","getMinor","reset","ViewLobby","tempName","tempJoin","setName","createGame","value","onChange","event","target","placeholder","joinGame","ViewReset","confirmed","confirm","tryReset","ViewBoard","indexOf","nextIndex","newCurrent","clearNominations","clearMission","mIndex","board","currIndex","nextState","updateBoard","delta","vetoes","updateVetoes","anyDoubleFails","some","m","nextTurn","index","missionChange","clearMissionNoms","setMissionNoms","addVeto","DeleteLink","ErrorMessage","ViewSetup","newRoles","roles","push","updateRoles","findIndex","splice","errorMessage","shuffledPlayers","shuffledRoles","forEach","hasLady","sawLady","giveLadyTo","revealPlayers","id","hidePlayers","roleName","Color","canEdit","removeRole","addRole","allPlayers","isAssigned","currentPlayers","redRoles","blueRoles","o","reveal","clear","tryReveal","renderAdd","setIncludeLady","assign","renderReveal","renderRoles","SecretBox","RoleBox","ViewBar","collapseSecrets","myData","youSee","playerIds","pdata","style","color","host","textDecoration","ViewNominate","updateNominationsTally","getIsDealer","alert","newRoster","isDealer","sortedPlayers","outOfRoster","sortedTally","currentMission","currentNeeded","removeFromRoster","addToRoster","lockTheNoms","ViewLady","sawPid","takeLadyFrom","ladySaw","myPlayer","examinedPlayer","examinedRole","ExaminedColor","currentPlayer","currentName","previousOwners","eligible","examine","ViewAll","ViewRules","src","alt","height","width","maxWidth","border","HeaderLink","hasLink","ViewHub","Link","type","setView","children","genGuestGameData","e","Lobby","Error","localData","updateGame","getGameData","hostData","myId","localMe","remoteMe","All","onReceive","setGame","pow","toString","padStart","genHostGameData","leaveGame","Setup","Nominate","Mission","Lady","Debug","Rules","Loading","renderMain","ErrorBoundary","hasError","error","info","reload","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.735b8ee4.chunk.js","sourcesContent":["import dotenv from 'dotenv';\nimport firebase from 'firebase/app';\nimport 'firebase/database';\nimport { BoardData, GameData, MissionData, MissionVote, Nomination, NominationData, PlayersById, Role, TurnData } from './types';\n\ndotenv.config();\nconst config = {\n  apiKey: process.env.REACT_APP_apiKey,\n  authDomain: process.env.REACT_APP_authDomain,\n  databaseURL: process.env.REACT_APP_databaseURL,\n  projectId: process.env.REACT_APP_projectId,\n  storageBucket: process.env.REACT_APP_storageBucket,\n  messagingSenderId: process.env.REACT_APP_messagingSenderId,\n  appId: process.env.REACT_APP_appId,\n  measurementId: process.env.REACT_APP_measurementId,\n};\n\nclass FirebaseSingleton {\n  private db: firebase.database.Database;\n  isOnline = true;\n\n  constructor() {\n    firebase.initializeApp(config);\n    this.db = firebase.database();\n  }\n\n  // debug\n  async getAllGames() {\n    console.log('fetching all game data');\n    return new Promise<GameData[]>((resolve, reject) => {\n      this.db.ref(`game`).once('value', resp => {\n        const data = resp.val();\n        console.log('got all games:', data)\n        resolve(Object.values(data || {}) as GameData[]);\n      });\n    });\n  }\n  async kickPlayer(game: GameData, playerId: string) {\n    const { gid, nominations, players, turn, mission } = game;\n    nominations.roster = (nominations.roster || []).filter(pid => pid !== playerId);\n    delete (nominations.tally || {})[playerId];\n    delete (players || {})[playerId];\n    if (turn) {\n      turn.order = turn.order.filter(pid => pid !== playerId);\n      if (turn.current === playerId) {\n        turn.current = turn.order[0];\n      }\n    }\n    delete (mission.tally || {})[playerId];\n    await this.updateNominations(gid, nominations);\n    await this.updatePlayers(gid, players);\n    await this.updateTurn(gid, turn);\n    await this.updateMission(gid, mission);\n  }\n  deleteAllGames() {\n    return this.db.ref(`game`).set({});\n  }\n\n  hidePlayers(gid: string) {\n    return this.db.ref(`game/${gid}/reveal`).set(false);\n  }\n  revealPlayers(gid: string) {\n    return this.db.ref(`game/${gid}/reveal`).set(true);\n  }\n\n  giveLadyTo(gid: string, pid: string) {\n    return this.db.ref(`game/${gid}/players/${pid}/hasLady`).set(true);\n  }\n  takeLadyFrom(gid: string, pid: string) {\n    return this.db.ref(`game/${gid}/players/${pid}/hasLady`).set(false);\n  }\n  ladySaw(gid: string, pid: string, sawId: string) {\n    return this.db.ref(`game/${gid}/players/${pid}/sawLady`).set(sawId);\n  }\n  setIncludeLady(gid: string, includeLady: boolean) {\n    return this.db.ref(`game/${gid}/includeLady`).set(includeLady);\n  }\n\n  clearMission(gameId: string) {\n    return this.updateMission(gameId, {\n      showResults: false,\n      tally: {},\n    });\n  }\n  clearNominations(gameId: string) {\n    return this.updateNominations(gameId, {\n      roster: [],\n      dealerLocked: false,\n      showResults: false,\n      tally: {},\n    });\n  }\n\n  updateGame(data: GameData) {\n    console.log('saving data:', data);\n    return this.db.ref(`game/${data.gid}`).set(data);\n  }\n  updateBoard(gameId: string, data: BoardData) {\n    return this.db.ref(`game/${gameId}/board`).set(data);\n  }\n  updateMission(gameId: string, data: MissionData) {\n    return this.db.ref(`game/${gameId}/mission`).set(data);\n  }\n  updateMissionTally(gameId: string, pid: string, data: MissionVote) {\n    return this.db.ref(`game/${gameId}/mission/tally/${pid}`).set(data);\n  }\n  updateNominations(gameId: string, data: NominationData) {\n    return this.db.ref(`game/${gameId}/nominations`).set(data);\n  }\n  updateNominationsTally(gameId: string, pid: string, data: Nomination) {\n    return this.db.ref(`game/${gameId}/nominations/tally/${pid}`).set(data);\n  }\n  updatePlayers(gameId: string, data: PlayersById) {\n    return this.db.ref(`game/${gameId}/players`).set(data);\n  }\n  updateRoles(gameId: string, data: Role[]) {\n    return this.db.ref(`game/${gameId}/roles`).set(data);\n  }\n  updateTurn(gameId: string, data: TurnData | null) {\n    return this.db.ref(`game/${gameId}/turn`).set(data || null);\n  }\n  updateVetoes(gameId: string, data: number) {\n    return this.db.ref(`game/${gameId}/vetoes`).set(data);\n  }\n\n  async getGameData(gameId: string) {\n    console.log('fetching game data');\n    return new Promise<GameData>((resolve, reject) => {\n      this.db.ref(`game/${gameId}`).once('value', resp => {\n        const data = resp.val();\n        console.log('got game data:', data)\n        resolve(data as GameData);\n      });\n    });\n  }\n\n  joinGame(gameId: string, callback: (val: any) => void) {\n    console.log('enabling hook:', gameId);\n    return this.db.ref(`game/${gameId}`).on('value', data => {\n      callback(data.val());\n    });\n  }\n  leaveGame(gameId: string) {\n    console.log('disabling hook:', gameId);\n    return this.db.ref(`game/${gameId}`).off('value');\n  }\n}\n\nexport const FIREBASE = new FirebaseSingleton();\n","// enums\n\nexport enum ViewTab {\n  Loading = 'loading',\n  Lobby = 'lobby',\n  All = 'all',\n  Board = 'board',\n  Nominate = 'nominate',\n  Mission = 'mission',\n  Lady = 'lady',\n  Setup = 'setup',\n  Reset = 'reset',\n  Debug = 'debug',\n  Rules = 'rules',\n};\n\nexport type MissionVote = 'success' | 'fail';\nexport const MissionVoteType = {\n  Success: 'success' as MissionVote,\n  Fail: 'fail' as MissionVote,\n};\n\nexport type Nomination = 'approve' | 'reject';\nexport const NominationType = {\n  Approve: 'approve' as Nomination,\n  Reject: 'reject' as Nomination,\n};\n\nexport type MissionResult = 'blue' | 'red' | 'neutral';\nexport const MissionResultType = {\n  Blue: 'blue victory' as MissionResult,\n  Red: 'red victory' as MissionResult,\n  Neutral: 'neutral' as MissionResult,\n};\nexport const MissionResults = Object.values(MissionResultType);\n\nexport const Roles = [\n  'BasicBlue',\n  'Merlin',\n  'Percival',\n  'BasicRed',\n  'Assassin',\n  'Mordred',\n  'Morgana',\n  'Oberon',\n] as const;\nexport type Role = typeof Roles[number];\nexport const RoleType = Roles.reduce((obj, r) => {\n  obj[r] = r;\n  return obj;\n}, {} as { [key in typeof Roles[number]]: Role });\n\n// interfaces\n\nexport interface MissionBlueprint {\n  result: MissionResult;\n  required: number;\n  neededFails: number;\n  roster?: string[] | null;\n}\n\nexport interface BoardData {\n  missions: MissionBlueprint[];\n  vetos: number;\n}\n\nexport interface PlayerData {\n  pid: string;\n  name: string;\n  role?: Role | null;\n  hasLady: boolean;\n  sawLady: string | null;\n}\n\nexport interface PlayersById {\n  [key: string]: PlayerData;\n};\n\nexport interface TurnData {\n  current: string;\n  order: string[];\n};\n\nexport interface NominationData {\n  showResults: boolean;\n  roster: string[];\n  dealerLocked: boolean;\n  tally: {\n    [key: string]: Nomination;\n  };\n};\n\nexport interface MissionData {\n  showResults: boolean;\n  tally: {\n    [key: string]: MissionVote;\n  };\n};\n\nexport interface GameData {\n  gid: string;\n  host?: string;\n  board: BoardData;\n  mission: MissionData;\n  nominations: NominationData;\n  players: PlayersById;\n  roles: Role[];\n  turn: TurnData | null;\n  vetoes: number;\n  includeLady: boolean;\n  reveal: boolean;\n}\n\nexport interface UserState {\n  v: string;\n  pid: string;\n  name?: string;\n  gid?: string;\n  view: ViewTab;\n}\n","import React from 'react';\nimport makeTrashable, { TrashablePromise } from 'trashable';\nimport { GameData } from '../core/types';\nimport { FIREBASE } from '../core/firebase';\n\ninterface Props { }\ninterface State {\n  games: GameData[];\n}\n\nexport class ViewDebug extends React.Component<Props, State> {\n  state: State = {\n    games: [],\n  };\n  promise?: TrashablePromise<GameData[]>;\n\n  componentDidMount() {\n    this.promise = makeTrashable(FIREBASE.getAllGames());\n    this.promise.then(games => this.setState({ games, }));\n  }\n  componentWillUnmount() {\n    if (this.promise) {\n      this.promise.trash();\n    }\n  }\n  render() {\n    const { games } = this.state;\n    return (\n      <div>\n        <h1>Debugging Health Info</h1>\n        <p>\n          <a href=\"https://mpaulweeks.github.io/avalon/\">mpaulweeks.github.io/avalon</a>\n        </p>\n        <h3>games</h3>\n        {games.map(game => (\n          <div key={game.gid}>\n            {game.gid}\n            {Object.values(game.players).map((p, pi) => (\n              <span key={pi + '-' + p.pid} onClick={() => FIREBASE.kickPlayer(game, p.pid)}>\n                &nbsp;/ {p.name}\n              </span>\n            ))}\n          </div>\n        ))}\n        <br />\n        <button onClick={() => FIREBASE.deleteAllGames()}> delete all </button>\n      </div>\n    );\n  }\n}\n","import { Role, Roles, RoleType } from './types';\n\nexport interface RoleData {\n  isRed: boolean;\n  name: string;\n  description: string;\n  sees: Role[];\n};\n\nconst reds = [RoleType.BasicRed, RoleType.Assassin, RoleType.Morgana, RoleType.Mordred, RoleType.Oberon];\nconst redsMinusMordred = reds.filter(r => r !== RoleType.Mordred);\nconst redsMinusOberon = reds.filter(r => r !== RoleType.Oberon);\n\nexport const AllRoles: { [key in typeof Roles[number]]: RoleData } = {\n  BasicBlue: {\n    isRed: false,\n    name: 'Basic Blue',\n    description: 'You know nothing. Good luck!',\n    sees: [],\n  },\n  Merlin: {\n    isRed: false,\n    name: 'Merlin',\n    description: 'You see the Red players. Help the Blue team without revealing yourself.',\n    sees: redsMinusMordred,\n  },\n  Percival: {\n    isRed: false,\n    name: 'Percival',\n    description: 'You see two players. One is your ally Merlin, the other is the enemy Morgana. You must figure out which is which.',\n    sees: [RoleType.Merlin, RoleType.Morgana],\n  },\n  BasicRed: {\n    isRed: true,\n    name: 'Basic Red',\n    description: 'You see your fellow Red players.',\n    sees: redsMinusOberon,\n  },\n  Assassin: {\n    isRed: true,\n    name: 'Assassin',\n    description: 'You see your fellow Red players. If you can guess Merlin at the end of the game, you win.',\n    sees: redsMinusOberon,\n  },\n  Mordred: {\n    isRed: true,\n    name: 'Mordred',\n    description: 'You see your fellow Red players. Merlin cannot see you',\n    sees: redsMinusOberon,\n  },\n  Morgana: {\n    isRed: true,\n    name: 'Morgana',\n    description: 'You see your fellow Red players. Percival sees you and Merlin. Try to confuse them.',\n    sees: redsMinusOberon,\n  },\n  Oberon: {\n    isRed: true,\n    name: 'Oberon',\n    description: 'You cannot see your fellow Red players and they cannot see you.',\n    sees: [],\n  },\n};\n","import styled from 'styled-components';\nimport { MissionResult, MissionResultType } from '../core/types';\n\nexport const Green = styled.span`\n  color: green;\n  font-weight: bold;\n`;\nexport const Blue = styled.span`\n  color: blue;\n  font-weight: bold;\n`;\nexport const Red = styled.span`\n  color: red;\n  font-weight: bold;\n`;\n\nexport const StyledBox = styled.div`\n  margin: 1rem 0;\n  padding: 0.8rem;\n  border: 0.2rem solid green;\n`;\n\nexport const HostBox = styled(StyledBox)`\n  border-color: purple;\n  background-color: plum;\n`;\n\nexport const Flex = styled.div`\n  display: flex;\n  flex-direction: horizontal;\n  text-align: center;\n  flex-wrap: nowrap;\n`;\n\nexport const Board = styled(Flex)``;\n\nexport const MissionIcon = styled.div<{ result: MissionResult }>`\n  font-size: 4rem;\n  margin: 0.2em;\n  width: 1.5em;\n  height: 1.5em;\n  border: 1px solid black;\n  border-radius: 2em;\n  cursor: pointer;\n\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  user-select: none;\n\n  ${props => `\n    ${props.result === MissionResultType.Neutral ? `\n      color: black;\n      background-color: white;\n    `: ''}\n    ${props.result === MissionResultType.Blue ? `\n      color: white;\n      background-color: blue;\n    `: ''}\n    ${props.result === MissionResultType.Red ? `\n      color: white;\n      background-color: red;\n    `: ''}\n  `}\n`;\n","import { GameData, MissionResultType } from \"./types\";\n\nexport const APP_VERSION = '1.4.1';\n\nexport const isDev = window.location.href.includes('localhost');\nexport const isDebug = window.location.href.includes('?d');\nif (!isDebug) {\n  const orig = console.log;\n  console.log = (...args: any[]) => { };\n  orig('activate debug move to view logs'.toUpperCase());\n}\n\nexport function randomId(length: number) {\n  return Math.floor(Math.random() * Math.pow(10, length)).toString().padStart(length, '0');\n}\n\nexport function sort<T, E>(arr: T[], keyFunc: (key: T) => E) {\n  return arr.concat().sort((a, b) => {\n    const ka = keyFunc(a);\n    const kb = keyFunc(b);\n    if (ka < kb) { return -1; }\n    if (ka > kb) { return 1; }\n    return 0;\n  });\n}\n\nexport function sortObjVals<T, E>(obj: { [key: string]: T }, keyFunc: (key: T) => E) {\n  return sort(Object.values(obj), keyFunc);\n}\n\n/**\n * Randomly shuffle an array\n * https://stackoverflow.com/a/2450976/1293256\n * @param  {Array} array The array to shuffle\n * @return {String}      The first item in the shuffled array\n */\nexport function shuffle<T>(orig: T[]): T[] {\n  const array = orig.concat();\n  var currentIndex = array.length;\n  var temporaryValue, randomIndex;\n\n  // While there remain elements to shuffle...\n  while (0 !== currentIndex) {\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n\n    // And swap it with the current element.\n    temporaryValue = array[currentIndex];\n    array[currentIndex] = array[randomIndex];\n    array[randomIndex] = temporaryValue;\n  }\n  return array;\n};\n\nexport function getCurrentPlayers(game: GameData) {\n  return (game.turn ? game.turn.order : []).map(pid => game.players[pid]);\n}\n\nexport function getBoardFor(count: number) {\n  let missions = [ // === 5\n    { required: 2, neededFails: 1, result: MissionResultType.Neutral },\n    { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n    { required: 2, neededFails: 1, result: MissionResultType.Neutral },\n    { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n    { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n  ];\n  if (count === 6) {\n    missions = [\n      { required: 2, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 4, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 4, neededFails: 1, result: MissionResultType.Neutral },\n    ];\n  }\n  if (count === 7) {\n    missions = [\n      { required: 2, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 4, neededFails: 2, result: MissionResultType.Neutral },\n      { required: 4, neededFails: 1, result: MissionResultType.Neutral },\n    ];\n  }\n  if (count >= 8) {\n    missions = [\n      { required: 3, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 4, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 4, neededFails: 1, result: MissionResultType.Neutral },\n      { required: 5, neededFails: 2, result: MissionResultType.Neutral },\n      { required: 5, neededFails: 1, result: MissionResultType.Neutral },\n    ];\n  }\n  return {\n    vetos: 0,\n    missions: missions,\n  };\n}\n","import React from 'react';\nimport { MissionVoteType, GameData, UserState, RoleType, NominationType } from '../core/types';\nimport { FIREBASE } from '../core/firebase';\nimport { AllRoles } from '../core/role';\nimport { HostBox, Green, Red } from './shared';\nimport { getCurrentPlayers } from '../core/utils';\n\ninterface Props {\n  isHost: boolean;\n  data: GameData;\n  storage: UserState;\n}\ninterface State { }\n\nexport class ViewMission extends React.Component<Props, State> {\n  pid = this.props.storage.pid;\n  state: State = {};\n\n  getMyRole() {\n    const { storage, data } = this.props;\n    const me = data.players[storage.pid] || {\n      name: storage.name,\n    };\n    return AllRoles[me.role || RoleType.BasicBlue];\n  }\n\n  async voteSuccess() {\n    await FIREBASE.updateMissionTally(this.props.data.gid, this.pid, MissionVoteType.Success);\n  }\n  async voteFail() {\n    await FIREBASE.updateMissionTally(this.props.data.gid, this.pid, MissionVoteType.Fail);\n  }\n  async voteClear() {\n    const newVotes = { ...this.props.data.mission, };\n    newVotes.tally = {};\n    newVotes.showResults = false;\n    await FIREBASE.updateMission(this.props.data.gid, newVotes);\n  }\n  async toggleReveal() {\n    const newVotes = { ...this.props.data.mission, };\n    newVotes.showResults = !newVotes.showResults;\n    await FIREBASE.updateMission(this.props.data.gid, newVotes);\n  }\n\n  render() {\n    const { isHost, data } = this.props;\n    const { nominations, mission } = data;\n\n    const nomRevealed = !!nominations.showResults;\n    const nomResults = Object.values(nominations.tally);\n    const nomApproved = nomResults.filter(n => n === NominationType.Approve).length > nomResults.length / 2;\n\n    if (!(nomRevealed && nomApproved)) {\n      return (\n        <div>\n          <h1>Mission Vote</h1>\n\n          <div>\n            Waiting for a nomination to be approved.\n          </div>\n        </div>\n      );\n    }\n\n    const isNom = nominations.roster.includes(this.pid);\n\n    const sortedPlayers = getCurrentPlayers(data);\n    const pendingTally = sortedPlayers.filter(p => nominations.roster.includes(p.pid) && !mission.tally[p.pid]);\n\n    return (\n      <div>\n        <h1>Mission Vote</h1>\n\n        {isNom ? (\n          <div>\n            <h3> cast your mission vote </h3>\n            {mission.tally[this.pid] ? (\n              <div> you have voted </div>\n            ) : (\n                <div>\n                  <button onClick={() => this.voteSuccess()}>vote SUCCESS</button>\n                  <button onClick={() => this.voteFail()}>vote FAIL</button>\n                </div>\n              )}\n          </div>\n        ) : (\n            <div>\n              only nominated players can vote during the mission\n            </div>\n          )}\n\n        <h3>results!</h3>\n        {mission.showResults && Object.keys(mission.tally).length ? (\n          <div>\n            {Object.values(mission.tally).sort().reverse().map((vote, i) => (\n              <div key={i}>\n                {vote === MissionVoteType.Success ? (\n                  <Green>{vote.toUpperCase()}</Green>\n                ) : (\n                    <Red>{vote.toUpperCase()}</Red>\n                  )}\n              </div>\n            ))}\n          </div>\n        ) : (\n            <div>\n              {Object.keys(mission.tally).length}/{nominations.roster.length} votes counted\n              {pendingTally.length ? (\n                <div>\n                  <br />\n                  waiting for:\n                  {pendingTally.map(p => (\n                    <div key={p.pid}>{p.name}</div>\n                  ))}\n                </div>\n              ) : ''}\n            </div>\n          )}\n\n        {isHost && (\n          <HostBox>\n            <button onClick={() => this.toggleReveal()}>{mission.showResults ? 'hide' : 'show'} votes</button>\n            <button onClick={() => this.voteClear()}>clear all votes</button>\n          </HostBox>\n        )}\n      </div>\n    );\n  }\n}\n","import { hri } from \"human-readable-ids\";\nimport { UserState, ViewTab } from \"./types\";\nimport { APP_VERSION } from \"./utils\";\n\nexport interface StorageLayer {\n  getItem(key: string): string | null;\n  setItem(key: string, value: string): void;\n}\n\nclass StorageSingleton {\n  store: StorageLayer = window.localStorage;\n  onSet: (val: UserState) => Promise<void> = () => Promise.resolve();\n\n  private getMinor(v: string) {\n    return (v || '0.0.0').split('.').slice(0, 2).join('.');\n  }\n\n  reset() {\n    this.set({\n      v: APP_VERSION,\n      pid: hri.random(),\n      name: undefined,\n      gid: undefined,\n      view: ViewTab.Reset,\n    });\n  }\n  private set(data: UserState): Promise<void> {\n    this.store.setItem('state', JSON.stringify(data));\n    return this.onSet(data);\n  }\n  setName(name: string) {\n    return this.set({\n      ...this.get(),\n      name: name,\n    });\n  }\n  setGame(gid: string) {\n    return this.set({\n      ...this.get(),\n      gid: gid,\n    });\n  }\n  setView(view: ViewTab) {\n    return this.set({\n      ...this.get(),\n      view: view,\n    });\n  }\n  get(): UserState {\n    const stored = this.store.getItem('state') || '{}';\n    const data = JSON.parse(stored as any) as UserState;\n    const isValid = data && this.getMinor(data.v) === this.getMinor(APP_VERSION);\n    if (isValid) {\n      return data;\n    }\n    this.reset();\n    return this.get();\n  }\n}\n\nexport const STORAGE = new StorageSingleton();\n","import React from 'react';\nimport { STORAGE } from '../core/storage';\nimport { hri } from 'human-readable-ids';\nimport { isDev } from '../core/utils';\nimport { UserState } from '../core/types';\n\ninterface Props {\n  storage: UserState;\n  createGame(): void;\n  joinGame(id: string): void;\n}\ninterface State {\n  tempName: string;\n  tempJoin: string;\n}\n\nexport class ViewLobby extends React.Component<Props, State> {\n  state: State = {\n    tempName: isDev ? hri.random().split('-')[0] : '',\n    tempJoin: '',\n  };\n\n  setName() {\n    STORAGE.setName(this.state.tempName);\n  }\n\n  render() {\n    const { storage } = this.props;\n    const { tempName, tempJoin } = this.state;\n\n    if (!storage.name) {\n      return (\n        <div>\n          <h1>Enter your name</h1>\n          <input value={tempName} onChange={event => this.setState({ tempName: event.target.value, })} />\n          <button onClick={() => this.setName()}>confirm</button>\n        </div>\n      )\n    }\n\n    return (\n      <div>\n        <h1>Find a Game</h1>\n\n        <div>\n          <button onClick={() => this.props.createGame()}>create new game</button>\n        </div>\n\n        <h3>or</h3>\n\n        <div>\n          <input\n            value={tempJoin}\n            onChange={event => this.setState({ tempJoin: event.target.value, })}\n            placeholder=\"enter game id\"\n          />\n          <br />\n          <br />\n          <button onClick={() => this.props.joinGame(tempJoin)}>join game</button>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { UserState } from '../core/types';\n\ninterface Props {\n  storage: UserState,\n  reset(): void;\n}\ninterface State { }\n\nexport class ViewReset extends React.Component<Props, State> {\n  tryReset() {\n    const { gid } = this.props.storage;\n    let confirmed = true;\n    if (gid) {\n      confirmed = window.confirm(\"Are you sure you want to reset?\\nIf you leave a game in progress, you will not be able to rejoin.\");\n    }\n    if (confirmed) {\n      this.props.reset();\n    }\n  }\n  render() {\n    const { storage } = this.props;\n    return (\n      <div>\n        <h1>Current Local State</h1>\n        <pre>\n          {JSON.stringify(storage, null, 2)}\n        </pre>\n        <div>\n          <button onClick={() => this.tryReset()}>Leave game and reset local data</button>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { GameData, MissionResults, UserState } from '../core/types';\nimport { FIREBASE } from '../core/firebase';\nimport { HostBox, Board, MissionIcon } from './shared';\n\ninterface Props {\n  data: GameData;\n  isHost: boolean;\n  storage: UserState;\n}\ninterface State { }\n\nexport class ViewBoard extends React.Component<Props, State> {\n  async nextTurn() {\n    const { gid, turn } = this.props.data;\n    if (!turn) { return; }\n    const currentIndex = turn.order.indexOf(turn.current);\n    const nextIndex = (currentIndex + 1) % turn.order.length;\n    const newCurrent = turn.order[nextIndex];\n    await FIREBASE.updateTurn(gid, {\n      ...turn,\n      current: newCurrent,\n    });\n    await FIREBASE.clearNominations(gid);\n    await FIREBASE.clearMission(gid);\n  }\n  async missionChange(mIndex: number) {\n    const { isHost, data } = this.props;\n    if (!isHost) { return; }\n    const { gid, board } = data;\n    const mission = board.missions[mIndex];\n    const currIndex = MissionResults.indexOf(mission.result);\n    const nextIndex = (currIndex + 1) % MissionResults.length;\n    const nextState = MissionResults[nextIndex];\n    mission.result = nextState;\n    await FIREBASE.updateBoard(gid, board);\n  }\n\n  async setMissionNoms(mIndex: number) {\n    const { isHost, data } = this.props;\n    if (!isHost) { return; }\n    const { gid, board } = data;\n    const mission = board.missions[mIndex];\n    mission.roster = data.nominations.roster;\n    await FIREBASE.updateBoard(gid, board);\n  }\n  async clearMissionNoms(mIndex: number) {\n    const { isHost, data } = this.props;\n    if (!isHost) { return; }\n    const { gid, board } = data;\n    const mission = board.missions[mIndex];\n    mission.roster = null;\n    await FIREBASE.updateBoard(gid, board);\n  }\n  async addVeto(delta: number) {\n    const { isHost, data } = this.props;\n    if (!isHost) { return; }\n    const { gid, vetoes } = data;\n    await FIREBASE.updateVetoes(gid, vetoes + delta);\n  }\n\n  render() {\n    const { isHost, data } = this.props;\n    const { board, turn, players, vetoes } = data;\n    const anyDoubleFails = board.missions.some(m => m.neededFails > 1);\n\n    return (\n      <div>\n        <h1>Game Board</h1>\n        {turn && (\n          <div>\n            {isHost && (\n              <HostBox>\n                <button onClick={() => this.nextTurn()}>\n                  Next Turn\n                </button>\n              </HostBox>\n            )}\n          </div>\n        )}\n\n        <Board>\n          {board.missions.map((m, index) => (\n            <div key={index}>\n              <MissionIcon result={m.result} onClick={() => this.missionChange(index)}>\n                {m.required}\n              </MissionIcon>\n              {anyDoubleFails && (\n                m.neededFails > 1 ? (\n                  <div>\n                    {m.neededFails} fails needed\n                  </div>\n                ) : <br />\n              )}\n              {m.roster && m.roster.map(pid => (\n                <div key={pid}>\n                  {players[pid].name}\n                </div>\n              ))}\n              {isHost && (\n                <HostBox>\n                  {m.roster ? (\n                    <button onClick={() => this.clearMissionNoms(index)}>\n                      remove<br />noms\n                    </button>\n                  ) : (\n                      <button onClick={() => this.setMissionNoms(index)}>\n                        set<br />noms\n                      </button>\n                    )}\n                </HostBox>\n              )}\n            </div>\n          ))}\n        </Board>\n        <div>\n          Missions are played left to right. The number is how many people are required for each mission.\n          <br />\n          It only takes 1 FAIL to win the mission for Red. First team to 3 missions wins.\n        </div>\n\n        <h3>\n          Vetoes: {vetoes}/4\n        </h3>\n        <div>\n          When the number of vetoes reaches 4, the nomination automatically goes to mission without a group vote.\n        </div>\n\n        {isHost && (\n          <HostBox>\n            <button onClick={() => this.addVeto(1)}>+</button>\n            <button onClick={() => this.addVeto(-1)}>-</button>\n          </HostBox>\n        )}\n\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport styled from 'styled-components';\nimport { AllRoles } from '../core/role';\nimport { GameData, Role, Roles, UserState, PlayerData } from '../core/types';\nimport { getBoardFor, shuffle, sortObjVals, getCurrentPlayers } from \"../core/utils\";\nimport { FIREBASE } from '../core/firebase';\nimport { HostBox, Blue, Red } from './shared';\n\nconst DeleteLink = styled.span`\n  cursor: pointer;\n  text-decoration: underline;\n  color: red;\n`;\n\nconst ErrorMessage = styled.span`\n  color: red;\n`;\n\ninterface Props {\n  isHost: boolean;\n  data: GameData;\n  storage: UserState;\n}\ninterface State {\n  errorMessage?: string;\n}\n\nexport class ViewSetup extends React.Component<Props, State> {\n  state: State = {}\n\n  async addRole(role: Role) {\n    const newRoles = [...this.props.data.roles];\n    newRoles.push(role);\n    newRoles.sort();\n    await FIREBASE.updateRoles(this.props.data.gid, newRoles);\n  }\n  async removeRole(role: Role) {\n    const newRoles = [...this.props.data.roles];\n    const index = newRoles.findIndex(r => r === role);\n    if (index >= 0) {\n      newRoles.splice(index, 1);\n      await FIREBASE.updateRoles(this.props.data.gid, newRoles);\n    }\n  }\n  async assign() {\n    const { gid, players, roles, includeLady } = this.props.data;\n    if (Object.keys(players).length !== roles.length) {\n      return this.setState({\n        errorMessage: 'you need the same number of roles as players',\n      });\n    }\n    this.setState({ errorMessage: undefined });\n    const shuffledPlayers = shuffle(Object.keys(players));\n    const shuffledRoles = shuffle(roles);\n    shuffledPlayers.forEach((pid, index) => {\n      players[pid].role = shuffledRoles[index];\n      players[pid].hasLady = false;\n      players[pid].sawLady = null;\n    });\n    await FIREBASE.updateBoard(gid, getBoardFor(roles.length));\n    await FIREBASE.updatePlayers(gid, players);\n    await FIREBASE.updateTurn(gid, {\n      current: shuffledPlayers[0],\n      order: shuffledPlayers,\n    });\n    await FIREBASE.clearNominations(gid);\n    await FIREBASE.clearMission(gid);\n    if (includeLady) {\n      await FIREBASE.giveLadyTo(gid, shuffledPlayers.slice(-1)[0]);\n    }\n  }\n  async tryReveal() {\n    const { gid } = this.props.data;\n    const confirmed = window.confirm(\"Are you sure you want to reveal roles?\\nThis cannot be undone and effectively ends the game.\");\n    if (confirmed) {\n      await FIREBASE.revealPlayers(gid);\n    }\n  }\n  async clear() {\n    const { gid, players } = this.props.data;\n    Object.keys(players).forEach((id, index) => {\n      players[id].role = null; // null for Firebase\n    });\n    await FIREBASE.updatePlayers(gid, players);\n    await FIREBASE.updateTurn(gid, null);\n    await FIREBASE.hidePlayers(gid);\n  }\n\n  renderReveal(players: PlayerData[]) {\n    return (\n      <ul>\n        {players.map((p, i) => {\n          const role = p.role && AllRoles[p.role];\n          const roleName = role ? role.name : '???';\n          const Color = (role && role.isRed) ? Red : Blue;\n          return (\n            <li key={i}>\n              {p.name}: <Color>{roleName}</Color>\n            </li>\n          );\n        })}\n      </ul>\n    );\n  }\n  renderRoles(roles: Role[], canEdit: boolean) {\n    return (\n      <ul>\n        {roles.map((role, i) => {\n          const data = AllRoles[role];\n          const Color = data.isRed ? Red : Blue;\n          return (\n            <li key={i}>\n              {canEdit && <DeleteLink onClick={() => this.removeRole(role)}>X</DeleteLink>}\n              &nbsp;<Color>{data.name}</Color>\n              &nbsp;<i>({data.description})</i>\n            </li>\n          );\n        })}\n      </ul>\n    );\n  }\n  renderAdd(roles: Role[]) {\n    return (\n      <div>\n        {roles.map((r, i) => (\n          <button key={i} onClick={() => this.addRole(r)}>\n            {AllRoles[r].name}\n          </button>\n        ))}\n      </div>\n    )\n  }\n  render() {\n    const { isHost, data } = this.props;\n    const { errorMessage } = this.state;\n\n    const allPlayers = sortObjVals(data.players, p => p.name);\n    const isAssigned = allPlayers.some(p => p.role);\n    const canEdit = isHost && !isAssigned;\n    const currentPlayers = isAssigned ? getCurrentPlayers(data) : allPlayers;\n\n    const redRoles = Object.values(data.roles).filter(r => AllRoles[r].isRed);\n    const blueRoles = Object.values(data.roles).filter(r => !AllRoles[r].isRed);\n\n    return (\n      <div>\n        <h1>Setup</h1>\n\n        <h3>\n          Players: {currentPlayers.length}\n        </h3>\n        <div>\n          {currentPlayers.map(o => o.name).join(', ')}\n        </div>\n\n        {isHost && (\n          <HostBox>\n            {isAssigned ? (\n              data.reveal ? (\n                <button onClick={() => this.clear()}>Clear roles and reset game</button>\n              ) : (\n                <button onClick={() => this.tryReveal()}>\n                  Reveal all roles\n                </button>\n              )\n            ) : (\n                <div>\n                  {this.renderAdd(Roles.filter(r => AllRoles[r].isRed))}\n                  <br />\n                  {this.renderAdd(Roles.filter(r => !AllRoles[r].isRed))}\n                  <br />\n                  <div>\n                    <button onClick={() => FIREBASE.setIncludeLady(data.gid, !data.includeLady)}>\n                      {data.includeLady ? 'Lady of the Lake is ON' : 'Lady of the Lake is OFF'}\n                    </button>\n                  </div>\n                  <br />\n                  <div>\n                    <button onClick={() => this.assign()}>ASSIGN ROLES</button>\n                    {errorMessage && (\n                      <ErrorMessage>{errorMessage}</ErrorMessage>\n                    )}\n                    </div>\n                </div>\n              )}\n          </HostBox>\n        )}\n\n        {data.reveal && (\n          <div>\n            <h3>GAME OVER! This was everyone's identity:</h3>\n            {this.renderReveal(currentPlayers)}\n          </div>\n        )}\n\n        <h3>Red Roles ({redRoles.length})</h3>\n        {this.renderRoles(redRoles, canEdit)}\n\n        <h3>Blue Roles ({blueRoles.length})</h3>\n        {this.renderRoles(blueRoles, canEdit)}\n\n        {isHost && (\n          <HostBox>\n            <h3>Kick Player</h3>\n            <p>\n              Mostly an emergency tool if someone resets their info.\n              <br />\n              If the player refreshes without resetting their info, they will rejoin.\n            </p>\n\n            {allPlayers.map(p => (\n              <button key={p.pid} onClick={() => FIREBASE.kickPlayer(data, p.pid)}>\n                {p.name}\n              </button>\n            ))}\n          </HostBox>\n        )}\n      </div>\n    );\n  }\n}\n","import React, { CSSProperties } from 'react';\nimport styled from 'styled-components';\nimport { AllRoles } from '../core/role';\nimport { GameData, RoleType, UserState } from '../core/types';\nimport { StyledBox } from './shared';\nimport { getCurrentPlayers, sortObjVals } from '../core/utils';\n\nexport const SecretBox = styled(StyledBox)`\n  background-color: black;\n  color: white;\n  border-color: red;\n  cursor: pointer;\n`;\n\nexport const RoleBox = styled(StyledBox)`\n  border-color: black;\n  background-color: #eeeeee;\n\n  & span {\n    margin: 0 0.1em;\n  }\n`;\n\ninterface Props {\n  storage: UserState;\n  data: GameData;\n}\ninterface State {\n  collapseSecrets: boolean;\n}\n\nexport class ViewBar extends React.Component<Props, State> {\n  state: State = {\n    collapseSecrets: false,\n  };\n\n  render() {\n    const { storage, data } = this.props;\n    const { collapseSecrets } = this.state;\n    const me = data.players[storage.pid] || {\n      name: storage.name,\n    };\n    const myData = AllRoles[me.role || RoleType.BasicBlue];\n    const others = (data.turn ? data.turn.order : []).filter(id => id !== storage.pid).map(key => data.players[key]);\n    const youSee = others.filter(o => o.role && myData.sees.includes(o.role)).map(o => o.name);\n\n    const nominations = data.nominations.roster.length > 0 ? data.nominations.roster.map(pid => data.players[pid].name).join(', ') : '(nobody)';\n    const playerIds = data.turn ? data.turn.order : getCurrentPlayers(data).map(p => p.pid);\n\n    const allPlayers = sortObjVals(data.players, p => p.name);\n\n    return (\n      <div>\n        <SecretBox onClick={() => this.setState({ collapseSecrets: !collapseSecrets, })}>\n          {collapseSecrets ? (\n            <div>\n              (click to show secret info)\n            </div>\n          ) : (\n              <div>\n                <div>\n                  <u>\n                    SECRET INFO! do not discuss what's in this box! click to hide from nearby players!\n                    </u>\n                </div>\n                {me.role ? (\n                  <div>\n                    you are: <b>{myData.name}</b>. you see: <b>{youSee.join(', ') || '(nobody)'}</b>\n                    <br />\n                    {myData.description}\n                  </div>\n                ) : (\n                    <div>\n                      roles haven't been assigned yet\n                    </div>\n                  )}\n              </div>\n            )}\n        </SecretBox>\n        <RoleBox>\n          {data.turn ? (\n            <div>\n              <div>\n                turn order: {playerIds.map((pid, index, array) => {\n                const pdata = data.players[pid];\n                const name = (pdata ? pdata.name : '???') + (index < array.length - 1 ? ',' : '');\n                const style: CSSProperties = {\n                  color: pid === data.host ? 'purple' : 'black',\n                  textDecoration: (data.turn && pid === data.turn.current) ? 'underline' : 'none',\n                };\n                return (\n                  <span key={pid} style={style}>\n                    {name}\n                  </span>\n                );\n              })}\n              </div>\n              <div>\n                nomination: {nominations}\n              </div>\n            </div>\n          ) : (\n              <div>\n                players: {allPlayers.map(p => p.name).join(', ')}\n              </div>\n            )}\n        </RoleBox>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { GameData, NominationType, MissionResultType, UserState } from '../core/types';\nimport { FIREBASE } from '../core/firebase';\nimport { HostBox, Green, Red } from './shared';\nimport { getCurrentPlayers } from '../core/utils';\n\ninterface Props {\n  isHost: boolean;\n  data: GameData;\n  storage: UserState;\n}\ninterface State { }\n\nexport class ViewNominate extends React.Component<Props, State> {\n  pid = this.props.storage.pid;\n  state: State = {};\n\n  async voteSuccess() {\n    await FIREBASE.updateNominationsTally(this.props.data.gid, this.pid, NominationType.Approve);\n  }\n  async voteFail() {\n    await FIREBASE.updateNominationsTally(this.props.data.gid, this.pid, NominationType.Reject);\n  }\n  async voteClear() {\n    const newVotes = { ...this.props.data.nominations, };\n    newVotes.tally = {};\n    newVotes.showResults = false;\n    newVotes.dealerLocked = false;\n    await FIREBASE.updateNominations(this.props.data.gid, newVotes);\n  }\n  async toggleReveal() {\n    const newVotes = { ...this.props.data.nominations, };\n    newVotes.showResults = !newVotes.showResults;\n    await FIREBASE.updateNominations(this.props.data.gid, newVotes);\n  }\n  async lockTheNoms() {\n    const isDealer = this.getIsDealer();\n    if (!isDealer) {\n      return alert('only the dealer should be able to lock the nom! error!');\n    }\n    const newVotes = { ...this.props.data.nominations, };\n    newVotes.dealerLocked = true;\n    await FIREBASE.updateNominations(this.props.data.gid, newVotes);\n  }\n\n  getIsDealer() {\n    const { data } = this.props;\n    const { nominations } = data;\n    return data.turn && (data.turn.current === this.pid) && !nominations.showResults;\n  }\n\n  async addToRoster(pid: string) {\n    const { nominations } = this.props.data;\n    const newRoster = [...nominations.roster];\n    newRoster.push(pid);\n    newRoster.sort();\n    await FIREBASE.updateNominations(this.props.data.gid, {\n      ...nominations,\n      roster: newRoster,\n    });\n  }\n  async removeFromRoster(pid: string) {\n    const { nominations } = this.props.data;\n    const newRoster = [...nominations.roster];\n    const index = newRoster.findIndex(p => p === pid);\n    if (index >= 0) {\n      newRoster.splice(index, 1);\n      await FIREBASE.updateNominations(this.props.data.gid, {\n        ...nominations,\n        roster: newRoster,\n      });\n    }\n  }\n\n  render() {\n    const { isHost, data } = this.props;\n    const { nominations, players } = data;\n    const isDealer = this.getIsDealer();\n    const sortedPlayers = getCurrentPlayers(data);\n    const outOfRoster = sortedPlayers.filter(p => !nominations.roster.includes(p.pid));\n    const sortedTally = Object.keys(nominations.tally).sort();\n    const pendingTally = sortedPlayers.filter(p => !nominations.tally[p.pid]);\n\n    const currentMission = data.board.missions.filter(m => m.result === MissionResultType.Neutral)[0];\n    const currentNeeded = currentMission ? currentMission.required : '???';\n\n    return (\n      <div>\n        <h1>Nominate for Mission</h1>\n\n        <div>This mission requires {currentNeeded} people.</div>\n\n        <h3>Nominated:</h3>\n        <div>\n          {nominations.roster.length ? (\n            (isDealer && !nominations.dealerLocked) ? nominations.roster.map((pid, i) => (\n              <button key={i} onClick={() => this.removeFromRoster(pid)}>\n                {players[pid].name}\n              </button>\n            )) : (\n                nominations.roster.map(pid => players[pid].name).join(', ')\n              )\n          ) : (\n              'nobody has been nominated yet'\n            )}\n        </div>\n\n        {isDealer && (\n          nominations.dealerLocked ? (\n            <div>\n              <br />\n              <button onClick={() => this.voteClear()}>Clear votes and change the nomination</button>\n            </div>\n          ) : (\n              <div>\n                <h3>Add to Nomination:</h3>\n                <div>\n                  {outOfRoster.length > 0 ? (\n                    outOfRoster.map((p, i) => (\n                      <button key={i} onClick={() => this.addToRoster(p.pid)}>\n                        {p.name}\n                      </button>\n                    ))\n                  ) : (\n                      'everyone has been nominated'\n                    )}\n                </div>\n              </div>\n            ))}\n\n        {!nominations.dealerLocked ? (\n          <div>\n            <h3>\n              waiting for nomination to be locked in...\n            </h3>\n            {isDealer && (\n              <div>\n                <button onClick={() => this.lockTheNoms()}>Lock and start voting</button>\n              </div>\n            )}\n          </div>\n        ) : (\n            <div>\n              <h3>cast your vote for who goes on the mission</h3>\n\n              {nominations.tally[this.pid] && (\n                <div>\n                  you have voted\n                </div>\n              )}\n              {!nominations.showResults && (\n                <div>\n                  <button onClick={() => this.voteSuccess()}>vote SUPPORT</button>\n                  <button onClick={() => this.voteFail()}>vote REJECT</button>\n                </div>\n              )}\n\n              {isHost && (\n                <HostBox>\n                  <button onClick={() => this.toggleReveal()}>{nominations.showResults ? 'hide' : 'show'} votes</button>\n                  <button onClick={() => this.voteClear()}>clear all votes</button>\n                </HostBox>\n              )}\n\n              <h3>results!</h3>\n\n              {nominations.showResults && Object.keys(nominations.tally).length ? (\n                <div>\n                  {sortedTally.map((pid, i) => (\n                    <div key={i}>\n                      {data.players[pid].name}:&nbsp;\n                      {nominations.tally[pid] === NominationType.Approve ? (\n                        <Green>{nominations.tally[pid].toUpperCase()}</Green>\n                      ) : (\n                          <Red>{nominations.tally[pid].toUpperCase()}</Red>\n                        )}\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                  <div>\n                    {Object.keys(nominations.tally).length}/{sortedPlayers.length} votes counted\n                    {pendingTally.length ? (\n                      <div>\n                        <br />\n                    waiting for:\n                        {pendingTally.map(p => (\n                          <div key={p.pid}>{p.name}</div>\n                        ))}\n                      </div>\n                    ) : ''}\n                  </div>\n                )}\n            </div>\n          )}\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { GameData, UserState } from '../core/types';\nimport { FIREBASE } from '../core/firebase';\nimport { AllRoles } from '../core/role';\nimport { Red, Blue } from './shared';\nimport { getCurrentPlayers } from '../core/utils';\n\ninterface Props {\n  isHost: boolean;\n  data: GameData;\n  storage: UserState;\n}\ninterface State { }\n\nexport class ViewLady extends React.Component<Props, State> {\n  pid = this.props.storage.pid;\n  state: State = {};\n\n  async examine(sawPid: string) {\n    const { pid } = this;\n    const { gid } = this.props.data;\n    await FIREBASE.giveLadyTo(gid, sawPid);\n    await FIREBASE.takeLadyFrom(gid, pid);\n    await FIREBASE.ladySaw(gid, pid, sawPid);\n  }\n\n  render() {\n    const { data } = this.props;\n    const { players, includeLady } = data;\n\n    const myPlayer = players[this.pid];\n    const examinedPlayer = myPlayer.sawLady && players[myPlayer.sawLady];\n    const examinedRole = examinedPlayer && examinedPlayer.role && AllRoles[examinedPlayer.role];\n    const ExaminedColor = examinedRole && examinedRole.isRed ? Red : Blue;\n\n    const currentPlayers = getCurrentPlayers(data);\n    const currentPlayer = currentPlayers.filter(p => p.hasLady)[0];\n    const currentName = currentPlayer && currentPlayer.name;\n    const previousOwners = currentPlayers.filter(p => !!p.sawLady);\n    const eligible = currentPlayers.filter(p => p.pid !== this.pid && !p.sawLady);\n\n    return (\n      <div>\n        <h1>Lady of the Lake</h1>\n\n        <p>\n          At the beginning of the game, the Lady of the Lake (aka Lady) is given to the last player in the turn order.\n        </p>\n        <p>\n          After the 2nd, 3rd, and 4th mission is finished, the player with the Lady may choose one player to examine.\n        </p>\n        <p>\n          They will learn the team color (Red/Blue) of the chosen player. They will NOT learn their identity (eg: Merlin).\n        </p>\n        <p>\n          After this information is revealed, the Lady will transfer to the examined player, so that they may use it after the next mission.\n        </p>\n        <p>\n          A player that used the Lady cannot have the Lady used on them.\n        </p>\n\n        {(includeLady && currentPlayer) ? (\n          <div>\n            <h3>{currentName} has the Lady of the Lake</h3>\n            {previousOwners.length > 0 && (\n              <div>\n                Previous Lady holders: {previousOwners.map(p => p.name).join(', ')}\n              </div>\n            )}\n            {currentPlayer.pid === this.pid && (\n              <div>\n                <p>\n                  <u>\n                    Choose a player to examine:\n                  </u>\n                </p>\n                <div>\n                  {eligible.map(p => (\n                    <button\n                      key={p.pid}\n                      onClick={() => this.examine(p.pid)}>\n                        {p.name}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n            {(examinedPlayer && examinedRole) && (\n              <h3>\n                You examined {examinedPlayer.name} and saw <ExaminedColor>{examinedRole.isRed ? 'RED' : 'BLUE'}</ExaminedColor>\n              </h3>\n            )}\n          </div>\n        ) : (\n          <h3>\n            <Red>\n              Lady of the Lady is not enabled for this game\n            </Red>\n          </h3>\n        )}\n      </div>\n    )\n  }\n}\n","import React from 'react';\nimport { ViewNominate } from './ViewNominate';\nimport { ViewMission } from './ViewMission';\nimport { ViewBoard } from './ViewBoard';\nimport { GameData, UserState } from '../core/types';\n\ninterface Props {\n  data: GameData;\n  isHost: boolean;\n  storage: UserState;\n}\n\nexport const ViewAll = (props: Props) => (\n  <div>\n    <ViewBoard {...props} />\n    <ViewNominate {...props} />\n    <ViewMission {...props} />\n  </div>\n);\n","import React from 'react';\n\ninterface Props { }\ninterface State { }\n\nexport class ViewRules extends React.Component<Props, State> {\n  render() {\n    return (\n      <div>\n        <h1>\n          Rules (<a target=\"_blank\" href=\"rules.pdf\">Rulebook.pdf</a>)\n        </h1>\n        <div>\n          <img src=\"roles.gif\" alt=\"character rules\" style={{\n            height: 'auto',\n            width: '106vh',\n            maxWidth: '100%',\n            border: '1px solid black',\n          }} />\n        </div>\n        <div>\n          <i>visualization courtesy of Adam Chawansky</i>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { ViewDebug } from \"./ViewDebug\";\nimport { ViewMission } from \"./ViewMission\";\nimport { ViewLobby } from \"./ViewLobby\";\nimport { ViewReset } from \"./ViewReset\";\nimport { FIREBASE } from \"../core/firebase\";\nimport { GameData, PlayersById, UserState, ViewTab } from \"../core/types\";\nimport { isDebug, getBoardFor, randomId, APP_VERSION } from \"../core/utils\";\nimport { STORAGE } from \"../core/storage\";\nimport { ViewBoard } from \"./ViewBoard\";\nimport { ViewSetup } from \"./ViewSetup\";\nimport { ViewBar } from \"./ViewBar\";\nimport { ViewNominate } from \"./ViewNominate\";\nimport { ViewLady } from \"./ViewLady\";\nimport { StyledBox } from \"./shared\";\nimport { ViewAll } from \"./ViewAll\";\nimport { ViewRules } from \"./ViewRules\";\n\nconst HeaderLink = styled(StyledBox) <{ current: boolean, hasLink: boolean }>`\n  margin: 0 0.5em;\n  margin-top: 0;\n  border-color: #00000000;\n  border-top-width: 0;\n  & a {\n    color: inherit;\n  }\n\n  ${props => props.hasLink ? `\n    & span {\n      cursor: pointer;\n      text-decoration: underline;\n    }\n  ` : ''}\n\n  ${props => props.current ? `\n    border-color: grey;\n  ` : ''}\n\n  &:first-child {\n    margin-left: 0;\n  }\n`;\n\ninterface Props { }\ninterface State {\n  storage: UserState;\n  data?: GameData;\n}\n\ninterface LinkProps {\n  type?: ViewTab;\n}\n\nexport class ViewHub extends React.Component<Props, State> {\n  state: State = {\n    storage: STORAGE.get(),\n  };\n  componentDidMount() {\n    STORAGE.onSet = val => new Promise((resolve, reject) => {\n      this.setState({ storage: val }, resolve);\n    });\n    const { storage } = this.state;\n    if (storage.name && storage.gid) {\n      try {\n        this.join(this.genGuestGameData());\n      } catch (e) {\n        // bubble up to ErrorBoundary\n        this.setState(() => { throw e; });\n      }\n    } else {\n      STORAGE.setView(ViewTab.Lobby);\n    }\n  }\n\n  private genHostGameData(): GameData {\n    const { pid } = this.state.storage;\n    return {\n      ...this.genGuestGameData(),\n      host: pid,\n    };\n  }\n  private genGuestGameData(): GameData {\n    const { pid, name, gid } = this.state.storage;\n    if (!gid) {\n      throw new Error('game should be set in localStorage');\n    }\n    return {\n      gid: gid,\n      host: undefined,\n      board: getBoardFor(7),\n      nominations: {\n        showResults: false,\n        dealerLocked: false,\n        roster: [],\n        tally: {},\n      },\n      roles: [],\n      players: {\n        [pid]: {\n          pid: pid,\n          name: name || '???',\n          hasLady: false,\n          sawLady: null,\n        },\n      },\n      turn: null,\n      vetoes: 0,\n      mission: {\n        showResults: false,\n        tally: {},\n      },\n      includeLady: false,\n      reveal: false,\n    };\n  }\n\n  private async join(localData: GameData) {\n    const { storage } = this.state;\n    if (localData.host) {\n      await FIREBASE.updateGame(localData);\n    } else {\n      // if joining a game, ensure self and broadcast\n      const hostData = await FIREBASE.getGameData(localData.gid);\n      if (!hostData) {\n        // if no game data for old id, reset\n        this.reset();\n        return;\n      }\n\n      // add self to host.players, but prefer local name\n      const myId = storage.pid;\n      const localMe = localData.players[myId];\n      const remoteMe = hostData.players[myId] || {};\n      const players: PlayersById = {\n        ...hostData.players,\n        [myId]: {\n          ...localMe,\n          ...remoteMe,\n          name: localMe.name,\n        },\n      };\n      await FIREBASE.updatePlayers(localData.gid, players);\n    }\n    if (storage.view === ViewTab.Lobby) {\n      STORAGE.setView(ViewTab.All);\n    }\n    await FIREBASE.joinGame(localData.gid, data => this.onReceive(data));\n  }\n  private onReceive(data: GameData) {\n    console.log('received:', data);\n    this.setState({\n      data: {\n        roles: [],\n        turn: null,\n        ...data,\n        nominations: {\n          roster: [],\n          tally: {},\n          ...data.nominations,\n        },\n        mission: {\n          tally: {},\n          ...data.mission,\n        },\n      }\n    });\n  }\n\n  async createGame() {\n    await STORAGE.setGame(randomId(3));\n    await this.join(this.genHostGameData());\n  }\n  async joinGame(gameId: string) {\n    await STORAGE.setGame(gameId);\n    await this.join(this.genGuestGameData());\n  }\n  async reset() {\n    const { data, storage } = this.state;\n    if (storage.gid) {\n      await FIREBASE.leaveGame(storage.gid);\n    }\n    if (data) {\n      await FIREBASE.kickPlayer(data, storage.pid);\n    }\n    this.setState({\n      data: undefined,\n    }, () => STORAGE.reset());\n  }\n\n  renderMain() {\n    const { storage, data } = this.state;\n    const { pid, view } = storage;\n    const isHost = !!data && pid === data.host;\n    if (view === ViewTab.All && data) {\n      return <ViewAll isHost={isHost} data={data} storage={storage} />\n    }\n    if (view === ViewTab.Board && data) {\n      return <ViewBoard isHost={isHost} data={data} storage={storage} />\n    }\n    if (view === ViewTab.Setup && data) {\n      return <ViewSetup isHost={isHost} data={data} storage={storage} />\n    }\n    if (view === ViewTab.Nominate && data) {\n      return <ViewNominate isHost={isHost} data={data} storage={storage} />\n    }\n    if (view === ViewTab.Mission && data) {\n      return <ViewMission isHost={isHost} data={data} storage={storage} />\n    }\n    if (view === ViewTab.Lady && data) {\n      return <ViewLady isHost={isHost} data={data} storage={storage} />\n    }\n\n    if (view === ViewTab.Lobby && !data) {\n      return <ViewLobby\n        storage={storage}\n        createGame={() => this.createGame()}\n        joinGame={gid => this.joinGame(gid)}\n      />\n    }\n\n    if (view === ViewTab.Reset) {\n      return <ViewReset\n        storage={storage}\n        reset={() => this.reset()}\n      />\n    }\n    if (view === ViewTab.Debug) {\n      return <ViewDebug />\n    }\n    if (view === ViewTab.Rules) {\n      return <ViewRules />\n    }\n\n    if (view === ViewTab.Loading) {\n      return (\n        <h3>\n          connecting to server, please wait...\n        </h3>\n      );\n    }\n\n    return (\n      <div>\n        <h3>you have reached an invalid state :(</h3>\n        <div>view: {view}</div>\n        <div>data: {!!data}</div>\n        <h3>please try refreshing and/or reset your local state</h3>\n      </div>\n    )\n  }\n\n  Link: React.StatelessComponent<LinkProps> = (props) => {\n    const { type } = props;\n    const onClick = !!type ? () => STORAGE.setView(type) : () => { };\n    return (\n      <HeaderLink\n        current={type === this.state.storage.view}\n        hasLink={!!type}\n        onClick={onClick}\n      >\n        <span>{props.children}</span>\n      </HeaderLink>\n    );\n  }\n\n  render() {\n    const { storage, data } = this.state;\n    return (\n      <div>\n        <nav>\n          <ul>\n            {data && <this.Link type={ViewTab.All}>Game #{data.gid}</this.Link>}\n            {data && <this.Link type={ViewTab.Board}>Board</this.Link>}\n            {data && <this.Link type={ViewTab.Nominate}>Nominate</this.Link>}\n            {data && <this.Link type={ViewTab.Mission}>Mission</this.Link>}\n            {data && <this.Link type={ViewTab.Lady}>Lady of the Lake</this.Link>}\n            {data && <this.Link type={ViewTab.Setup}>Setup</this.Link>}\n            {!data && <this.Link type={ViewTab.Lobby}>Lobby</this.Link>}\n            <this.Link type={ViewTab.Reset}>Reset</this.Link>\n            {isDebug && <this.Link type={ViewTab.Debug}>Debug</this.Link>}\n            <this.Link type={ViewTab.Rules}>Rules</this.Link>\n            <this.Link>v.{APP_VERSION}</this.Link>\n          </ul>\n        </nav>\n\n        {data && (\n          <ViewBar data={data} storage={storage} />\n        )}\n\n        {this.renderMain()}\n\n      </div>\n    );\n  }\n}\n","import React, { ErrorInfo } from 'react';\nimport { STORAGE } from '../core/storage';\n\ninterface Props {}\ninterface State {\n  hasError: boolean;\n}\n\nexport class ErrorBoundary extends React.Component<Props, State> {\n  state: State = {\n    hasError: false,\n  };\n\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  componentDidCatch(error: Error, info: ErrorInfo) {\n    console.log('error caught by boundary!', error, info);\n    this.setState({ hasError: true });\n  }\n\n  reset() {\n    STORAGE.reset();\n    window.location.reload();\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div>\n          <h1>Something went wrong.</h1>\n          Try refreshing first. If that doesn't work and you're stuck on this screen, <button onClick={() => this.reset()}>RESET LOCAL DATA</button>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport { ViewHub } from './fe/ViewHub';\nimport { ErrorBoundary } from './fe/ErrorBoundary';\n\nReactDOM.render(\n  <ErrorBoundary>\n    <ViewHub />\n  </ErrorBoundary>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}
(this.webpackJsonpavalon=this.webpackJsonpavalon||[]).push([[0],{30:function(e,t,n){e.exports=n(46)},35:function(e,t,n){},46:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),i=n.n(o),l=(n(35),n(8)),s=n.n(l),u=n(9),c=n(11),d=n(3),m=n(1),p=n(2),h=n(4),f=n(5),v=n(6),y=n(7),b=n(26),g=n.n(b),E=n(17),k=n.n(E);n(39);g.a.config();var j={apiKey:"AIzaSyAEz0EOh3rS5AQ1XyG4YQcHVtI9QvjbLQY",authDomain:"avalon-db-d62ad.firebaseapp.com",databaseURL:"https://avalon-db-d62ad.firebaseio.com",projectId:"avalon-db-d62ad",storageBucket:"avalon-db-d62ad.appspot.com",messagingSenderId:"964793644074",appId:"1:964793644074:web:1cce0c458aa896732fbf53",measurementId:"G-E2SERHMFE4"},O=new(function(){function e(){Object(m.a)(this,e),this.db=void 0,this.isOnline=!0,k.a.initializeApp(j),this.db=k.a.database()}return Object(p.a)(e,[{key:"getAllGames",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching all game data"),e.abrupt("return",new Promise((function(e,n){t.db.ref("game").once("value",(function(t){var n=t.val();console.log("got all games:",n),e(Object.values(n||{}))}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"kickPlayer",value:function(){var e=Object(u.a)(s.a.mark((function e(t,n){var a,r,o,i,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.gid,r=t.nominations,o=t.players,i=t.turn,l=t.mission,r.roster=(r.roster||[]).filter((function(e){return e!==n})),delete(r.tally||{})[n],delete(o||{})[n],i&&(i.order=i.order.filter((function(e){return e!==n})),i.current===n&&(i.current=i.order[0])),delete(l.tally||{})[n],e.next=8,this.updateNominations(a,r);case 8:return e.next=10,this.updatePlayers(a,o);case 10:return e.next=12,this.updateTurn(a,i);case 12:return e.next=14,this.updateMission(a,l);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteAllGames",value:function(){this.db.ref("game").set({})}},{key:"clearMission",value:function(e){return this.updateMission(e,{showResults:!1,tally:{}})}},{key:"clearNominations",value:function(e){return this.updateNominations(e,{roster:[],dealerLocked:!1,showResults:!1,tally:{}})}},{key:"updateGame",value:function(e){return console.log("saving data:",e),this.db.ref("game/".concat(e.gid)).set(e)}},{key:"updateBoard",value:function(e,t){return this.db.ref("game/".concat(e,"/board")).set(t)}},{key:"updateMission",value:function(e,t){return this.db.ref("game/".concat(e,"/mission")).set(t)}},{key:"updateMissionTally",value:function(e,t,n){return this.db.ref("game/".concat(e,"/mission/tally/").concat(t)).set(n)}},{key:"updateNominations",value:function(e,t){return this.db.ref("game/".concat(e,"/nominations")).set(t)}},{key:"updateNominationsTally",value:function(e,t,n){return this.db.ref("game/".concat(e,"/nominations/tally/").concat(t)).set(n)}},{key:"updatePlayers",value:function(e,t){return this.db.ref("game/".concat(e,"/players")).set(t)}},{key:"updateRoles",value:function(e,t){return this.db.ref("game/".concat(e,"/roles")).set(t)}},{key:"updateTurn",value:function(e,t){return this.db.ref("game/".concat(e,"/turn")).set(t||null)}},{key:"updateVetoes",value:function(e,t){return this.db.ref("game/".concat(e,"/vetoes")).set(t)}},{key:"getGameData",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching game data"),e.abrupt("return",new Promise((function(e,a){n.db.ref("game/".concat(t)).once("value",(function(t){var n=t.val();console.log("got game data:",n),e(n)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"joinGame",value:function(e,t){console.log("enabling hook:",e),this.db.ref("game/".concat(e)).on("value",(function(e){t(e.val())}))}},{key:"leaveGame",value:function(e){console.log("disabling hook:",e),this.db.ref("game/".concat(e)).off("value")}}]),e}()),w=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={games:[]},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;O.getAllGames().then((function(t){return e.setState({games:t})}))}},{key:"render",value:function(){var e=this.state.games;return r.a.createElement("div",null,r.a.createElement("h1",null,"Debugging Health Info"),r.a.createElement("p",null,r.a.createElement("a",{href:"https://mpaulweeks.github.io/avalon/"},"mpaulweeks.github.io/avalon")),r.a.createElement("h3",null,"games"),e.map((function(e){return r.a.createElement("div",{key:e.gid},e.gid,Object.values(e.players).map((function(t){return r.a.createElement("span",{key:t.pid,onClick:function(){return O.kickPlayer(e,t.pid)}},"\xa0/ ",t.name)})))})),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return O.deleteAllGames()}}," delete all "))}}]),n}(r.a.Component),R="loading",C="lobby",N="game",M="nominate",S="mission",G="setup",F="reset",x="debug",L="success",T="fail",A="approve",q="reject",B={Blue:"blue victory",Red:"red victory",Neutral:"neutral"},I=Object.values(B),P=["BasicBlue","Merlin","Percival","BasicRed","Assassin","Mordred","Morgana","Oberon"],D=P.reduce((function(e,t){return e[t]=t,e}),{}),H=[D.BasicRed,D.Assassin,D.Morgana,D.Mordred,D.Oberon],V=H.filter((function(e){return e!==D.Mordred})),J=H.filter((function(e){return e!==D.Oberon})),U={BasicBlue:{isRed:!1,name:"Basic Blue",description:"You know nothing. Good luck!",sees:[]},Merlin:{isRed:!1,name:"Merlin",description:"Those are the red players.",sees:V},Percival:{isRed:!1,name:"Percival",description:"You see two players. One is your ally Merlin, the other is the enemy Morgana. You must figure out which is which.",sees:[D.Merlin,D.Morgana]},BasicRed:{isRed:!0,name:"Basic Red",description:"They are your fellow Red players.",sees:J},Assassin:{isRed:!0,name:"Assassin",description:"They are your fellow Red players. You get to guess Merlin at the end of the game.",sees:J},Mordred:{isRed:!0,name:"Mordred",description:"They are your fellow Red players. Merlin cannot see you",sees:J},Morgana:{isRed:!0,name:"Morgana",description:"They are your fellow Red players. Percival sees you and Merlin. Try to confuse them.",sees:J},Oberon:{isRed:!0,name:"Oberon",description:"You cannot see your Red allies.",sees:[]}};function Y(){var e=Object(v.a)(["\n  font-size: 4rem;\n  margin: 0.2em;\n  width: 1.5em;\n  height: 1.5em;\n  border: 1px solid black;\n  border-radius: 2em;\n  cursor: pointer;\n\n  display: flex;\n  justify-content: center;\n  align-items: center;\n\n  user-select: none;\n\n  ","\n"]);return Y=function(){return e},e}function z(){var e=Object(v.a)([""]);return z=function(){return e},e}function Q(){var e=Object(v.a)(["\n  display: flex;\n  flex-direction: horizontal;\n  text-align: center;\n  flex-wrap: nowrap;\n"]);return Q=function(){return e},e}function K(){var e=Object(v.a)(["\n  border-color: purple;\n  background-color: plum;\n"]);return K=function(){return e},e}function X(){var e=Object(v.a)(["\n  margin: 1rem 0;\n  padding: 0.8rem;\n  border: 0.2rem solid green;\n"]);return X=function(){return e},e}function W(){var e=Object(v.a)(["\n  color: red;\n  font-weight: bold;\n"]);return W=function(){return e},e}function _(){var e=Object(v.a)(["\n  color: green;\n  font-weight: bold;\n"]);return _=function(){return e},e}var Z=y.a.span(_()),$=y.a.span(W()),ee=y.a.div(X()),te=Object(y.a)(ee)(K()),ne=y.a.div(Q()),ae=Object(y.a)(ne)(z()),re=y.a.div(Y(),(function(e){return"\n    ".concat(e.result===B.Neutral?"\n      color: black;\n      background-color: white;\n    ":"","\n    ").concat(e.result===B.Blue?"\n      color: white;\n      background-color: blue;\n    ":"","\n    ").concat(e.result===B.Red?"\n      color: white;\n      background-color: red;\n    ":"","\n  ")})),oe=window.location.href.includes("localhost"),ie=window.location.href.includes("#d");if(!ie){var le=console.log;console.log=function(){},le("activate debug move to view logs".toUpperCase())}function se(e,t){return function(e,t){return e.concat().sort((function(e,n){var a=t(e),r=t(n);return a<r?-1:a>r?1:0}))}(Object.values(e),t)}function ue(e){for(var t,n,a=e.concat(),r=a.length;0!==r;)n=Math.floor(Math.random()*r),t=a[r-=1],a[r]=a[n],a[n]=t;return a}function ce(e){var t=[{required:2,neededFails:1,result:B.Neutral},{required:3,neededFails:1,result:B.Neutral},{required:2,neededFails:1,result:B.Neutral},{required:3,neededFails:1,result:B.Neutral},{required:3,neededFails:1,result:B.Neutral}];return 6===e&&(t=[{required:2,neededFails:1,result:B.Neutral},{required:3,neededFails:1,result:B.Neutral},{required:4,neededFails:1,result:B.Neutral},{required:3,neededFails:1,result:B.Neutral},{required:4,neededFails:1,result:B.Neutral}]),7===e&&(t=[{required:2,neededFails:1,result:B.Neutral},{required:3,neededFails:1,result:B.Neutral},{required:3,neededFails:1,result:B.Neutral},{required:4,neededFails:2,result:B.Neutral},{required:4,neededFails:1,result:B.Neutral}]),e>=8&&(t=[{required:3,neededFails:1,result:B.Neutral},{required:4,neededFails:1,result:B.Neutral},{required:4,neededFails:1,result:B.Neutral},{required:5,neededFails:2,result:B.Neutral},{required:5,neededFails:1,result:B.Neutral}]),{vetos:0,missions:t}}var de=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).pid=e.props.storage.pid,e.state={},e}return Object(p.a)(n,[{key:"getMyRole",value:function(){var e=this.props,t=e.storage,n=e.data.players[t.pid]||{name:t.name};return U[n.role||D.BasicBlue]}},{key:"voteSuccess",value:function(){O.updateMissionTally(this.props.data.gid,this.pid,L)}},{key:"voteFail",value:function(){O.updateMissionTally(this.props.data.gid,this.pid,T)}},{key:"voteClear",value:function(){var e=Object(d.a)({},this.props.data.mission);e.tally={},e.showResults=!1,O.updateMission(this.props.data.gid,e)}},{key:"toggleReveal",value:function(){var e=Object(d.a)({},this.props.data.mission);e.showResults=!e.showResults,O.updateMission(this.props.data.gid,e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.isHost,a=t.data,o=a.nominations,i=a.players,l=a.mission,s=o.roster.includes(this.pid),u=se(i,(function(e){return e.pid})).filter((function(e){return o.roster.includes(e.pid)&&!l.tally[e.pid]}));return r.a.createElement("div",null,r.a.createElement("h1",null,"Mission Vote"),s?r.a.createElement("div",null,r.a.createElement("h3",null," cast your mission vote "),l.tally[this.pid]?r.a.createElement("div",null," you have voted "):r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.voteSuccess()}},"vote SUCCESS"),r.a.createElement("button",{onClick:function(){return e.voteFail()}},"vote FAIL"))):r.a.createElement("div",null,"only nominated players can vote during the mission"),r.a.createElement("h3",null,"results!"),l.showResults&&Object.keys(l.tally).length?r.a.createElement("div",null,Object.values(l.tally).sort().reverse().map((function(e,t){return r.a.createElement("div",{key:t},e===L?r.a.createElement(Z,null,e.toUpperCase()):r.a.createElement($,null,e.toUpperCase()))}))):r.a.createElement("div",null,Object.keys(l.tally).length,"/",o.roster.length," votes counted",u.length?r.a.createElement("div",null,r.a.createElement("br",null),"waiting for:",u.map((function(e){return r.a.createElement("div",{key:e.pid},e.name)}))):""),n&&r.a.createElement(te,null,r.a.createElement("button",{onClick:function(){return e.toggleReveal()}},l.showResults?"hide":"show"," votes"),r.a.createElement("button",{onClick:function(){return e.voteClear()}},"clear all votes")))}}]),n}(r.a.Component),me=n(15),pe=new(function(){function e(){Object(m.a)(this,e),this.store=window.localStorage,this.onSet=function(){return Promise.resolve()}}return Object(p.a)(e,[{key:"getMinor",value:function(e){return(e||"0.0.0").split(".").slice(0,2).join(".")}},{key:"reset",value:function(){this.set({v:"1.2.6",pid:me.hri.random(),name:void 0,gid:void 0,view:F})}},{key:"set",value:function(e){return this.store.setItem("state",JSON.stringify(e)),this.onSet(e)}},{key:"setName",value:function(e){return this.set(Object(d.a)({},this.get(),{name:e}))}},{key:"setGame",value:function(e){return this.set(Object(d.a)({},this.get(),{gid:e}))}},{key:"setView",value:function(e){return this.set(Object(d.a)({},this.get(),{view:e}))}},{key:"get",value:function(){var e=this.store.getItem("state")||"{}",t=JSON.parse(e);return t&&this.getMinor(t.v)===this.getMinor("1.2.6")?t:(this.reset(),this.get())}}]),e}()),he=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={tempName:oe?me.hri.random().split("-")[0]:"",tempJoin:""},e}return Object(p.a)(n,[{key:"setName",value:function(){pe.setName(this.state.tempName)}},{key:"render",value:function(){var e=this,t=this.props.storage,n=this.state,a=n.tempName,o=n.tempJoin;return t.name?r.a.createElement("div",null,r.a.createElement("h1",null,"Find a Game"),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.props.createGame()}},"create new game")),r.a.createElement("h3",null,"or"),r.a.createElement("div",null,r.a.createElement("input",{value:o,onChange:function(t){return e.setState({tempJoin:t.target.value})},placeholder:"enter game id"}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return e.props.joinGame(o)}},"join game"))):r.a.createElement("div",null,r.a.createElement("h1",null,"Enter your name"),r.a.createElement("input",{value:a,onChange:function(t){return e.setState({tempName:t.target.value})}}),r.a.createElement("button",{onClick:function(){return e.setName()}},"confirm"))}}]),n}(r.a.Component),fe=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"tryReset",value:function(){var e=!0;this.props.storage.gid&&(e=window.confirm("Are you sure you want to reset?\nIf you leave a game in progress, you will not be able to rejoin.")),e&&this.props.reset()}},{key:"render",value:function(){var e=this,t=this.props.storage;return r.a.createElement("div",null,r.a.createElement("h1",null,"Current Local State"),r.a.createElement("pre",null,JSON.stringify(t,null,2)),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.tryReset()}},"Leave game and reset local data")))}}]),n}(r.a.Component),ve=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"nextTurn",value:function(){var e=this.props.data,t=e.gid,n=e.turn;if(n){var a=(n.order.indexOf(n.current)+1)%n.order.length,r=n.order[a];O.updateTurn(t,Object(d.a)({},n,{current:r})),O.clearNominations(t),O.clearMission(t)}}},{key:"missionChange",value:function(e){var t=this.props,n=t.isHost,a=t.data;if(n){var r=a.gid,o=a.board,i=o.missions[e],l=(I.indexOf(i.result)+1)%I.length,s=I[l];i.result=s,O.updateBoard(r,o)}}},{key:"setMissionNoms",value:function(e){var t=this.props,n=t.isHost,a=t.data;if(n){var r=a.gid,o=a.board;o.missions[e].roster=a.nominations.roster,O.updateBoard(r,o)}}},{key:"clearMissionNoms",value:function(e){var t=this.props,n=t.isHost,a=t.data;if(n){var r=a.gid,o=a.board;o.missions[e].roster=null,O.updateBoard(r,o)}}},{key:"addVeto",value:function(e){var t=this.props,n=t.isHost,a=t.data;if(n){var r=a.gid,o=a.vetoes;O.updateVetoes(r,o+e)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.isHost,a=t.data,o=a.board,i=a.turn,l=a.players,s=a.vetoes,u=o.missions.some((function(e){return e.neededFails>1}));return r.a.createElement("div",null,r.a.createElement("h1",null,"Game #",a.gid),i&&r.a.createElement("div",null,n&&r.a.createElement(te,null,r.a.createElement("button",{onClick:function(){return e.nextTurn()}},"Next Turn"))),r.a.createElement(ae,null,o.missions.map((function(t,a){return r.a.createElement("div",{key:a},r.a.createElement(re,{result:t.result,onClick:function(){return e.missionChange(a)}},t.required),u&&(t.neededFails>1?r.a.createElement("div",null,t.neededFails," fails needed"):r.a.createElement("br",null)),t.roster&&t.roster.map((function(e){return r.a.createElement("div",{key:e},l[e].name)})),n&&r.a.createElement(te,null,t.roster?r.a.createElement("button",{onClick:function(){return e.clearMissionNoms(a)}},"remove",r.a.createElement("br",null),"noms"):r.a.createElement("button",{onClick:function(){return e.setMissionNoms(a)}},"set",r.a.createElement("br",null),"noms")))}))),r.a.createElement("div",null,"Missions are played left to right. The number is how many people are required for each mission.",r.a.createElement("br",null),"It only takes 1 FAIL to win the mission for Red. First team to 3 missions wins."),r.a.createElement("h3",null,"Vetoes: ",s,"/4"),r.a.createElement("div",null,"When the number of vetoes reaches 4, the nomination automatically goes to mission without a group vote."),n&&r.a.createElement(te,null,r.a.createElement("button",{onClick:function(){return e.addVeto(1)}},"+"),r.a.createElement("button",{onClick:function(){return e.addVeto(-1)}},"-")))}}]),n}(r.a.Component),ye=n(10);function be(){var e=Object(v.a)(["\n  color: red;\n"]);return be=function(){return e},e}function ge(){var e=Object(v.a)(["\n  cursor: pointer;\n  text-decoration: underline;\n  color: red;\n"]);return ge=function(){return e},e}var Ee=y.a.span(ge()),ke=y.a.span(be()),je=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={},e}return Object(p.a)(n,[{key:"addRole",value:function(e){var t=Object(ye.a)(this.props.data.roles);t.push(e),t.sort(),O.updateRoles(this.props.data.gid,t)}},{key:"removeRole",value:function(e){var t=Object(ye.a)(this.props.data.roles),n=t.findIndex((function(t){return t===e}));n>=0&&(t.splice(n,1),O.updateRoles(this.props.data.gid,t))}},{key:"assign",value:function(){var e=this.props.data,t=e.gid,n=e.players,a=e.roles;if(Object.keys(n).length!==a.length)return this.setState({errorMessage:"you need the same number of roles as players"});this.setState({errorMessage:void 0});var r=ue(Object.keys(n)),o=ue(a);r.forEach((function(e,t){n[e].role=o[t]})),O.updateBoard(t,ce(a.length)),O.updatePlayers(t,n),O.updateTurn(t,{current:r[0],order:r}),O.clearNominations(t),O.clearMission(t)}},{key:"clear",value:function(){var e=this.props.data,t=e.gid,n=e.players;Object.keys(n).forEach((function(e,t){n[e].role=null})),O.updatePlayers(t,n),O.updateTurn(t,null)}},{key:"renderRoles",value:function(e,t){var n=this;return r.a.createElement("ul",null,e.map((function(e,a){return r.a.createElement("li",{key:a},t&&r.a.createElement(Ee,{onClick:function(){return n.removeRole(e)}},"X"),U[e].name)})))}},{key:"renderAdd",value:function(e){var t=this;return r.a.createElement("div",null,e.map((function(e,n){return r.a.createElement("button",{key:n,onClick:function(){return t.addRole(e)}},U[e].name)})))}},{key:"render",value:function(){var e=this,t=this.props,n=t.isHost,a=t.data,o=this.state.errorMessage,i=Object.values(a.players).some((function(e){return e.role})),l=n&&!i,s=Object.values(a.roles).filter((function(e){return U[e].isRed})),u=Object.values(a.roles).filter((function(e){return!U[e].isRed})),c=se(a.players,(function(e){return e.name}));return r.a.createElement("div",null,r.a.createElement("h1",null,"Setup"),r.a.createElement("h3",null,"Players: ",c.length),r.a.createElement("div",null,c.map((function(e){return e.name})).join(", ")),n&&r.a.createElement(te,null,i?r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.clear()}},"CLEAR ROLES (reset game)")):r.a.createElement("div",null,this.renderAdd(P.filter((function(e){return U[e].isRed}))),r.a.createElement("br",null),this.renderAdd(P.filter((function(e){return!U[e].isRed}))),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return e.assign()}},"ASSIGN ROLES"),o&&r.a.createElement(ke,null,o))),r.a.createElement("h3",null,"Red Roles (",s.length,")"),this.renderRoles(s,l),r.a.createElement("h3",null,"Blue Roles (",u.length,")"),this.renderRoles(u,l),n&&r.a.createElement(te,null,r.a.createElement("h3",null,"Kick Player"),r.a.createElement("p",null,"Mostly an emergency tool if someone resets their info.",r.a.createElement("br",null),"If the player refreshes without resetting their info, they will rejoin."),c.map((function(e){return r.a.createElement("button",{key:e.pid,onClick:function(){return O.kickPlayer(a,e.pid)}},e.name)}))))}}]),n}(r.a.Component);function Oe(){var e=Object(v.a)(["\n  cursor: pointer;\n"]);return Oe=function(){return e},e}function we(){var e=Object(v.a)(["\n  border-color: black;\n  background-color: #eeeeee;\n\n  & span {\n    margin: 0 0.1em;\n  }\n"]);return we=function(){return e},e}function Re(){var e=Object(v.a)(["\n  background-color: black;\n  color: white;\n  border-color: red;\n"]);return Re=function(){return e},e}var Ce=Object(y.a)(ee)(Re()),Ne=Object(y.a)(ee)(we()),Me=y.a.div(Oe()),Se=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={collapseSecrets:!1},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.storage,a=t.data,o=this.state.collapseSecrets,i=a.players[n.pid]||{name:n.name},l=U[i.role||D.BasicBlue],s=Object.keys(a.players).filter((function(e){return e!==n.pid})).map((function(e){return a.players[e]})).filter((function(e){return e.role&&l.sees.includes(e.role)})).map((function(e){return e.name})),u=a.nominations.roster.length>0?a.nominations.roster.map((function(e){return a.players[e].name})).join(", "):"(nobody)",c=a.turn?a.turn.order:Object.keys(a.players).sort();return r.a.createElement("div",null,r.a.createElement(Ce,null,o?r.a.createElement(Me,{onClick:function(){return e.setState({collapseSecrets:!1})}},"(click to show secret info)"):r.a.createElement(Me,{onClick:function(){return e.setState({collapseSecrets:!0})}},r.a.createElement("div",null,r.a.createElement("u",null,"SECRET INFO! do not discuss what's in this box! click to hide from nearby players!")),i.role?r.a.createElement("div",null,"you are: ",r.a.createElement("b",null,l.name),". you see: ",r.a.createElement("b",null,s.join(", ")||"(nobody)"),r.a.createElement("br",null),l.description):r.a.createElement("div",null,"roles haven't been assigned yet"))),r.a.createElement(Ne,null,r.a.createElement("div",null,"turn order: ",c.map((function(e,t,n){var o=a.players[e],i=(o?o.name:"???")+(t<n.length-1?",":""),l={color:e===a.host?"purple":"black",textDecoration:a.turn&&e===a.turn.current?"underline":"none"};return r.a.createElement("span",{key:e,style:l},i)}))),r.a.createElement("div",null,"nomination: ",u)))}}]),n}(r.a.Component),Ge=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).pid=e.props.storage.pid,e.state={},e}return Object(p.a)(n,[{key:"voteSuccess",value:function(){O.updateNominationsTally(this.props.data.gid,this.pid,A)}},{key:"voteFail",value:function(){O.updateNominationsTally(this.props.data.gid,this.pid,q)}},{key:"voteClear",value:function(){var e=Object(d.a)({},this.props.data.nominations);e.tally={},e.showResults=!1,e.dealerLocked=!1,O.updateNominations(this.props.data.gid,e)}},{key:"toggleReveal",value:function(){var e=Object(d.a)({},this.props.data.nominations);e.showResults=!e.showResults,O.updateNominations(this.props.data.gid,e)}},{key:"lockTheNoms",value:function(){if(!this.getIsDealer())return alert("only the dealer should be able to lock the nom! error!");var e=Object(d.a)({},this.props.data.nominations);e.dealerLocked=!0,O.updateNominations(this.props.data.gid,e)}},{key:"getIsDealer",value:function(){var e=this.props.data,t=e.nominations;return e.turn&&e.turn.current===this.pid&&!t.showResults}},{key:"addToRoster",value:function(e){var t=this.props.data.nominations,n=Object(ye.a)(t.roster);n.push(e),n.sort(),O.updateNominations(this.props.data.gid,Object(d.a)({},t,{roster:n}))}},{key:"removeFromRoster",value:function(e){var t=this.props.data.nominations,n=Object(ye.a)(t.roster),a=n.findIndex((function(t){return t===e}));a>=0&&(n.splice(a,1),O.updateNominations(this.props.data.gid,Object(d.a)({},t,{roster:n})))}},{key:"render",value:function(){var e=this,t=this.props,n=t.isHost,a=t.data,o=a.nominations,i=a.players,l=this.getIsDealer(),s=se(i,(function(e){return e.pid})),u=s.filter((function(e){return!o.roster.includes(e.pid)})),c=Object.keys(o.tally).sort(),d=s.filter((function(e){return!o.tally[e.pid]})),m=a.board.missions.filter((function(e){return e.result===B.Neutral}))[0],p=m?m.required:"???";return r.a.createElement("div",null,r.a.createElement("h1",null,"Nominate for Mission"),r.a.createElement("div",null,"This mission requires ",p," people."),r.a.createElement("h3",null,"Nominated:"),r.a.createElement("div",null,o.roster.length?l&&!o.dealerLocked?o.roster.map((function(t,n){return r.a.createElement("button",{key:n,onClick:function(){return e.removeFromRoster(t)}},i[t].name)})):o.roster.map((function(e){return i[e].name})).join(", "):"nobody has been nominated yet"),l&&(o.dealerLocked?r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return e.voteClear()}},"Clear votes and change the nomination")):r.a.createElement("div",null,r.a.createElement("h3",null,"Add to Nomination:"),r.a.createElement("div",null,u.length>0?u.map((function(t,n){return r.a.createElement("button",{key:n,onClick:function(){return e.addToRoster(t.pid)}},t.name)})):"everyone has been nominated"))),o.dealerLocked?r.a.createElement("div",null,r.a.createElement("h3",null,"cast your vote for who goes on the mission"),o.tally[this.pid]&&r.a.createElement("div",null,"you have voted"),!o.showResults&&r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.voteSuccess()}},"vote SUPPORT"),r.a.createElement("button",{onClick:function(){return e.voteFail()}},"vote REJECT")),n&&r.a.createElement(te,null,r.a.createElement("button",{onClick:function(){return e.toggleReveal()}},o.showResults?"hide":"show"," votes"),r.a.createElement("button",{onClick:function(){return e.voteClear()}},"clear all votes")),r.a.createElement("h3",null,"results!"),o.showResults&&Object.keys(o.tally).length?r.a.createElement("div",null,c.map((function(e,t){return r.a.createElement("div",{key:t},a.players[e].name,":\xa0",o.tally[e]===A?r.a.createElement(Z,null,o.tally[e].toUpperCase()):r.a.createElement($,null,o.tally[e].toUpperCase()))}))):r.a.createElement("div",null,Object.keys(o.tally).length,"/",Object.keys(i).length," votes counted",d.length?r.a.createElement("div",null,r.a.createElement("br",null),"waiting for:",d.map((function(e){return r.a.createElement("div",{key:e.pid},e.name)}))):"")):r.a.createElement("div",null,r.a.createElement("h3",null,"waiting for nomination to be locked in..."),l&&r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.lockTheNoms()}},"Lock and start voting"))))}}]),n}(r.a.Component);function Fe(){var e=Object(v.a)(["\n  margin: 0 0.5em;\n  margin-top: 0;\n  border-color: #00000000;\n  border-top-width: 0;\n  & a {\n    color: inherit;\n  }\n\n  ","\n\n  ","\n\n  &:first-child {\n    margin-left: 0;\n  }\n"]);return Fe=function(){return e},e}var xe=Object(y.a)(ee)(Fe(),(function(e){return e.hasLink?"\n    & span {\n      cursor: pointer;\n      text-decoration: underline;\n    }\n  ":""}),(function(e){return e.current?"\n    border-color: grey;\n  ":""})),Le=function(e){Object(f.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(m.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={storage:pe.get()},e.Link=function(t){var n=t.type,a=n?function(){return pe.setView(n)}:function(){};return r.a.createElement(xe,{current:n===e.state.storage.view,hasLink:!!n,onClick:a},r.a.createElement("span",null,t.children))},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;pe.onSet=function(t){return new Promise((function(n,a){e.setState({storage:t},n)}))};var t=this.state.storage;t.name&&t.gid?this.join(this.genGuestGameData()):pe.setView(C)}},{key:"genHostGameData",value:function(){var e=this.state.storage.pid;return Object(d.a)({},this.genGuestGameData(),{host:e})}},{key:"genGuestGameData",value:function(){var e=this.state.storage,t=e.pid,n=e.name,a=e.gid;if(!a)throw new Error("game should be set in localStorage");return{gid:a,host:void 0,board:ce(7),nominations:{showResults:!1,dealerLocked:!1,roster:[],tally:{}},roles:[],players:Object(c.a)({},t,{pid:t,name:n||"???"}),turn:null,vetoes:0,mission:{showResults:!1,tally:{}}}}},{key:"join",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,a,r,o,i,l,u=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.storage,!t.host){e.next=5;break}O.updateGame(t),e.next=16;break;case 5:return e.next=7,O.getGameData(t.gid);case 7:if(a=e.sent){e.next=11;break}return this.reset(),e.abrupt("return");case 11:r=n.pid,o=t.players[r],i=a.players[r]||{},l=Object(d.a)({},a.players,Object(c.a)({},r,Object(d.a)({},o,{},i,{name:o.name}))),O.updatePlayers(t.gid,l);case 16:n.view===C&&pe.setView(N),O.joinGame(t.gid,(function(e){return u.onReceive(e)}));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onReceive",value:function(e){console.log("received:",e),this.setState({data:Object(d.a)({roles:[],turn:null},e,{nominations:Object(d.a)({roster:[],tally:{}},e.nominations),mission:Object(d.a)({tally:{}},e.mission)})})}},{key:"createGame",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.setGame((t=3,Math.floor(Math.random()*Math.pow(10,t)).toString().padStart(t,"0")));case 2:this.join(this.genHostGameData());case 3:case"end":return e.stop()}var t}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"joinGame",value:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.setGame(t);case 2:this.join(this.genGuestGameData());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reset",value:function(){var e=this.state,t=e.data,n=e.storage;n.gid&&O.leaveGame(n.gid),t&&O.kickPlayer(t,n.pid),this.setState({data:void 0},(function(){return pe.reset()}))}},{key:"renderMain",value:function(){var e=this,t=this.state,n=t.storage,a=t.data,o=n.pid,i=n.view,l=!!a&&o===a.host;return i===N&&a?r.a.createElement(ve,{isHost:l,data:a,storage:n}):i===G&&a?r.a.createElement(je,{isHost:l,data:a,storage:n}):i===M&&a?r.a.createElement(Ge,{isHost:l,data:a,storage:n}):i===S&&a?r.a.createElement(de,{isHost:l,data:a,storage:n}):i!==C||a?i===F?r.a.createElement(fe,{storage:n,reset:function(){return e.reset()}}):i===x?r.a.createElement(w,null):i===R?r.a.createElement("h3",null,"connecting to server, please wait..."):r.a.createElement("div",null,r.a.createElement("h3",null,"you have reached an invalid state :("),r.a.createElement("div",null,"view: ",i),r.a.createElement("div",null,"data: ",!!a),r.a.createElement("h3",null,"please try refreshing and/or reset your local state")):r.a.createElement(he,{storage:n,createGame:function(){return e.createGame()},joinGame:function(t){return e.joinGame(t)}})}},{key:"render",value:function(){var e=this.state,t=e.storage,n=e.data;return r.a.createElement("div",null,r.a.createElement("nav",null,r.a.createElement("ul",null,n&&r.a.createElement(this.Link,{type:N},"Game #",n.gid),n&&r.a.createElement(this.Link,{type:M},"Nominate"),n&&r.a.createElement(this.Link,{type:S},"Mission"),n&&r.a.createElement(this.Link,{type:G},"Setup"),!n&&r.a.createElement(this.Link,{type:C},"Lobby"),r.a.createElement(this.Link,{type:F},"Reset"),ie&&r.a.createElement(this.Link,{type:x},"Debug"),r.a.createElement(this.Link,null,r.a.createElement("a",{target:"_blank",href:"rules.pdf"},"Rules")),r.a.createElement(this.Link,null,"v.","1.2.6"))),n&&r.a.createElement(Se,{data:n,storage:t}),this.renderMain())}}]),n}(r.a.Component);i.a.render(r.a.createElement(Le,null),document.getElementById("root"))}},[[30,1,2]]]);
//# sourceMappingURL=main.f3b8110c.chunk.js.map